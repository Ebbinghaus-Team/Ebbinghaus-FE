import{j as e,u as Z,a as L,r as i,b as ee,c as re,z as A}from"./index-CvvNVOg6.js";import{p as se,m as te}from"./apiMappers-ZSGH_g8X.js";import{u as le}from"./hooks-DVUgL80Q.js";function oe({saveLocation:r,setSaveLocation:s,selectedGroup:o,setSelectedGroup:u,selectedPersonalStudy:c,setSelectedPersonalStudy:a,myGroups:b,myPersonalStudies:l}){const g=l.length===0,m=b.length===0;return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["저장 위치 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx("div",{className:`border-2 rounded-lg p-4 transition-colors ${r==="personal"?"border-blue-500 bg-blue-50":"border-gray-200 "+(g?"opacity-60 cursor-not-allowed":"hover:border-gray-300 cursor-pointer")}`,onClick:()=>{g||s("personal")},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-user-line text-2xl text-blue-600 mr-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"개인 스터디"}),e.jsx("p",{className:"text-gray-600 text-sm",children:g?"개인 스터디가 없습니다":"나만의 문제집에 저장"})]})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${r==="personal"?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:r==="personal"&&e.jsx("i",{className:"ri-check-line text-white text-sm"})})]})}),e.jsx("div",{className:`border-2 rounded-lg p-4 transition-colors ${r==="group"?"border-blue-500 bg-blue-50":"border-gray-200 "+(m?"opacity-60 cursor-not-allowed":"hover:border-gray-300 cursor-pointer")}`,onClick:()=>{m||s("group")},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-team-line text-2xl text-blue-600 mr-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"그룹 스터디"}),e.jsx("p",{className:"text-gray-600 text-sm",children:m?"그룹 스터디가 없습니다":"그룹 멤버들과 공유"})]})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${r==="group"?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:r==="group"&&e.jsx("i",{className:"ri-check-line text-white text-sm"})})]})})]}),r==="personal"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"개인 스터디 선택"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[l.map(n=>e.jsxs("div",{className:`border rounded-lg p-3 cursor-pointer transition-colors ${c===n.id.toString()?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>a(n.id.toString()),children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:n.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:["문제 ",n.questions,"개"]})]},n.id)),l.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"개인 스터디가 없어 선택할 수 없습니다."})]})]}),r==="group"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"그룹 선택"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[b.map(n=>e.jsxs("div",{className:`border rounded-lg p-3 cursor-pointer transition-colors ${o===n.id.toString()?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>u(n.id.toString()),children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:n.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:["멤버 ",n.members,"명"]})]},n.id)),b.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"그룹 스터디가 없어 선택할 수 없습니다."})]})]})]})}function ae({questionType:r,setQuestionType:s}){return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["문제 유형 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition-colors ${r==="MCQ"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>s("MCQ"),children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-list-check text-3xl text-blue-600 mb-2"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"객관식"})]})}),e.jsx("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition-colors ${r==="OX"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>s("OX"),children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-checkbox-circle-line text-3xl text-blue-600 mb-2"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"O/X 문제"})]})}),e.jsx("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition-colors ${r==="SHORT"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>s("SHORT"),children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-text text-3xl text-blue-600 mb-2"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"단답형"})]})}),e.jsx("div",{className:`border-2 rounded-lg p-4 cursor-pointer transition-colors ${r==="SUBJECTIVE"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>s("SUBJECTIVE"),children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-edit-line text-3xl text-blue-600 mb-2"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"서술형"})]})})]})]})}function ne({subject:r,setSubject:s}){return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["과목/분야 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r,onChange:o=>s(o.target.value),placeholder:"예: 수학, 영어, 역사 등",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}function ie({question:r,setQuestion:s}){return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["문제 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:r,onChange:o=>s(o.target.value),placeholder:"문제를 입력하세요",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}function de({options:r,updateOption:s,addOption:o,removeOption:u,correctAnswer:c,setCorrectAnswer:a}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["선택지 (최소 2개) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-3",children:[r.map((b,l)=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-sm font-medium",children:String.fromCharCode(65+l)}),e.jsx("input",{type:"text",value:b,onChange:g=>s(l,g.target.value),placeholder:`${String.fromCharCode(65+l)}번 선택지`,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),r.length>2&&e.jsx("button",{onClick:()=>u(l),className:"w-8 h-8 flex items-center justify-center text-red-500 hover:bg-red-50 rounded-lg cursor-pointer",children:e.jsx("i",{className:"ri-close-line"})})]},l)),e.jsxs("button",{onClick:o,className:"w-full py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-500 hover:text-blue-600 transition-colors cursor-pointer whitespace-nowrap",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"선택지 추가"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["정답 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((b,l)=>e.jsx("button",{onClick:()=>a(String(l)),className:`w-12 h-12 rounded-lg border-2 font-medium transition-colors cursor-pointer ${c===String(l)?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 text-gray-600 hover:border-gray-400"}`,children:String.fromCharCode(65+l)},l))})]})]})}function ce({oxAnswer:r,setOxAnswer:s}){return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["정답 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>s("O"),className:`flex-1 py-3 rounded-lg border-2 font-medium transition-colors cursor-pointer ${r==="O"?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 text-gray-600 hover:border-gray-400"}`,children:"O (참)"}),e.jsx("button",{onClick:()=>s("X"),className:`flex-1 py-3 rounded-lg border-2 font-medium transition-colors cursor-pointer ${r==="X"?"border-blue-500 bg-blue-50 text-blue-600":"border-gray-300 text-gray-600 hover:border-gray-400"}`,children:"X (거짓)"})]})]})}function me({shortAnswer:r,setShortAnswer:s}){return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["정답 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r,onChange:o=>s(o.target.value),placeholder:"정답을 입력하세요",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}function xe({keywords:r,setKeywords:s,modelAnswer:o,setModelAnswer:u}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["핵심 키워드 (AI 채점용) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:r,onChange:c=>s(c.target.value),placeholder:"쉼표로 구분하여 입력 (예: 광합성, 엽록소, 이산화탄소)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"AI가 이 키워드를 기준으로 답안을 채점합니다"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["모범 답안 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:o,onChange:c=>u(c.target.value),placeholder:"모범 답안을 입력하세요",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]})}function ue({explanation:r,setExplanation:s}){return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["해설 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:r,onChange:o=>s(o.target.value),placeholder:"문제에 대한 해설을 입력하세요",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}function be({onSave:r,isEnabled:s}){return e.jsx("div",{className:"flex justify-end mt-8",children:e.jsx("button",{onClick:r,disabled:!s,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer",children:"문제 저장"})})}function je(){const r=Z(),[s]=L(),o=s.get("from"),u=s.get("studyId"),c=s.get("groupId"),[a,b]=i.useState(()=>o==="personal"?"personal":o==="group"?"group":""),[l,g]=i.useState(()=>o==="group"&&c?c:""),[m,n]=i.useState(()=>o==="personal"&&u?u:""),[d,$]=i.useState(""),[E,P]=i.useState(""),[p,R]=i.useState(""),[h,S]=i.useState(["",""]),[w,I]=i.useState(""),[j,X]=i.useState(""),[C,B]=i.useState(""),[v,M]=i.useState(""),[k,F]=i.useState(""),[O,Q]=i.useState(""),V=le(),{data:H}=ee(),{data:J}=re(),U=t=>{if(typeof t=="number"){I(String(t));return}typeof t=="string"&&I(t)},G=(H?.rooms??[]).map(t=>({id:t.studyRoomId,name:t.name,members:t.memberCount})),z=(J?.rooms??[]).map(t=>({id:t.studyRoomId,name:t.name,questions:t.totalProblems})),K=()=>{const t=d;let x=null;if(t==="MCQ"){const y=h.map(T=>T.trim()),N=Number.parseInt(w,10);if(!Number.isFinite(N)||Number.isNaN(N)||N<0||N>=y.length){A.error("객관식 정답을 선택해주세요.");return}if(!y.every(T=>T.length>0)){A.error("선택지는 비어 있을 수 없습니다.");return}x={problemType:"MCQ",question:p,explanation:j,choices:y,correctChoiceIndex:N}}else t==="OX"?x={problemType:"OX",question:p,explanation:j,answerBoolean:te(v)}:t==="SHORT"?x={problemType:"SHORT",question:p,explanation:j,answerText:C}:t==="SUBJECTIVE"&&(x={problemType:"SUBJECTIVE",question:p,explanation:j,modelAnswerText:O,keywords:se(k)});if(!x)return;const f=a==="group"?Number(l):a==="personal"?Number(m):NaN;Number.isFinite(f)&&V.mutate({studyRoomId:f,createProblemBody:x},{onSuccess:()=>{r(a==="group"&&l?`/groups/${l}`:a==="personal"&&m?`/personal-study/${m}`:"/dashboard")}})},_=(t,x)=>{const f=[...h];f[t]=x,S(f)},q=()=>{S([...h,""])},D=t=>{if(h.length>2){const x=h.filter((f,y)=>y!==t);S(x)}},W=()=>!a||!d||!E||!p||!j||a==="personal"&&!m||a==="group"&&!l?!1:d==="MCQ"?h.every(t=>t.trim())&&!!w:d==="OX"?v==="O"||v==="X":d==="SHORT"?C.trim().length>0:d==="SUBJECTIVE"?k.trim().length>0&&O.trim().length>0:!1,Y=a==="personal"?!!m:a==="group"?!!l:!1;return e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6 text-center",children:"문제 만들기"}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(oe,{saveLocation:a,setSaveLocation:b,selectedGroup:l,setSelectedGroup:g,selectedPersonalStudy:m,setSelectedPersonalStudy:n,myGroups:G,myPersonalStudies:z}),Y&&e.jsx(ae,{questionType:d,setQuestionType:$}),!!d&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{subject:E,setSubject:P}),e.jsx(ie,{question:p,setQuestion:R}),d==="MCQ"&&e.jsx(de,{options:h,updateOption:_,addOption:q,removeOption:D,correctAnswer:w,setCorrectAnswer:U}),d==="OX"&&e.jsx(ce,{oxAnswer:v,setOxAnswer:M}),d==="SHORT"&&e.jsx(me,{shortAnswer:C,setShortAnswer:B}),d==="SUBJECTIVE"&&e.jsx(xe,{keywords:k,setKeywords:F,modelAnswer:O,setModelAnswer:Q}),e.jsx(ue,{explanation:j,setExplanation:X})]})]}),e.jsx(be,{onSave:K,isEnabled:W()})]})})}export{je as default};
