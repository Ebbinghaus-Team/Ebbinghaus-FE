import{j as e,a as E,u as F,r as y}from"./index-DJP5h2fB.js";import{R as P}from"./ReviewAddModal-B0Olgl4m.js";import{a as X,b as q}from"./hooks-C5MM9IgE.js";import{a as B}from"./hooks-60jvNgBh.js";function L({onBack:s,questionType:i,category:d,title:r}){return e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{onClick:s,className:"flex items-center text-gray-500 hover:text-gray-700 mb-4",children:[e.jsx("i",{className:"ri-arrow-left-line text-xl mr-2"}),"뒤로 가기"]}),e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full",children:i}),e.jsx("span",{className:"text-sm text-gray-500",children:d})]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r})]})}function Q({content:s}){return e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"문제"}),e.jsx("p",{className:"text-gray-700 text-lg leading-relaxed",children:s})]})}function $({options:s,selectedAnswer:i,onSelect:d,onCancel:r,onSubmit:u,isSubmitDisabled:l}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-4",children:"답안 선택"}),e.jsx("div",{className:"space-y-3",children:s.map((h,c)=>e.jsxs("label",{className:"flex items-center space-x-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer",children:[e.jsx("input",{type:"radio",value:c,checked:i===c,onChange:()=>d(c),className:"text-blue-600"}),e.jsx("span",{className:"text-gray-900",children:h})]},c))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:r,className:"inline-flex items-center justify-center font-medium rounded-lg transition-colors whitespace-nowrap cursor-pointer border border-gray-300 text-gray-700 hover:bg-gray-50 focus:ring-2 focus:ring-blue-500 px-4 py-2 text-base",children:"취소"}),e.jsx("button",{onClick:u,disabled:l,className:"inline-flex items-center justify-center font-medium rounded-lg transition-colors whitespace-nowrap cursor-pointer bg-blue-600 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 px-4 py-2 text-base disabled:opacity-50 disabled:cursor-not-allowed",children:"답안 제출"})]})]})}function H({isCorrect:s,correctAnswerText:i,explanation:d,aiFeedback:r,currentGate:u,nextReviewDate:l,onConfirm:h}){const c=a=>{if(!a)return"-";const p=new Date(a);return Number.isNaN(p.getTime())?a:p.toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"})},m=(a=>a?a==="GATE_1"?"1차 관문":a==="GATE_2"?"2차 관문":a==="GRADUATED"?"완료":a:null)(u),b=l?c(l):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:`inline-flex items-center justify-center w-16 h-16 rounded-full mb-4 ${s?"bg-green-100":"bg-red-100"}`,children:e.jsx("i",{className:`text-2xl ${s?"ri-check-line text-green-600":"ri-close-line text-red-600"}`})}),e.jsx("h2",{className:`text-2xl font-bold mb-2 ${s?"text-green-600":"text-red-600"}`,children:s?"정답입니다!":"틀렸습니다"}),i&&e.jsxs("p",{className:"text-gray-600",children:["정답: ",i]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"해설"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-gray-700",children:d}),r&&e.jsxs("p",{className:"text-gray-700 mt-2",children:["AI 피드백: ",r]}),(m||b)&&e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:[m&&e.jsxs("span",{children:["현재 관문: ",m]}),m&&b&&e.jsx("span",{children:" / "}),b&&e.jsxs("span",{children:["다음 복습일: ",b]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:h,className:"inline-flex items-center justify-center font-medium rounded-lg transition-colors whitespace-nowrap cursor-pointer bg-blue-600 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 px-4 py-2 text-base",children:"확인"})})]})}function U({value:s,onChange:i,onCancel:d,onSubmit:r,isSubmitDisabled:u}){return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx("textarea",{value:s,onChange:l=>i(l.target.value),className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"답안을 입력하세요"})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:d,className:"inline-flex items-center justify-center font-medium rounded-lg transition-colors whitespace-nowrap cursor-pointer bg-white text-gray-700 hover:bg-gray-50 border border-gray-300 focus:ring-2 focus:ring-gray-300 px-4 py-2 text-base",children:"돌아가기"}),e.jsx("button",{onClick:r,disabled:u,className:`inline-flex items-center justify-center font-medium rounded-lg transition-colors whitespace-nowrap cursor-pointer px-4 py-2 text-base focus:ring-2 focus:ring-blue-500 ${u?"bg-blue-400 text-white cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:"제출하기"})]})]})}const K=()=>{const[s]=E(),i=F(),d=s.get("id"),r=s.get("from"),u=(s.get("isMy")??"false")==="true",[l,h]=y.useState(null),[c,v]=y.useState(""),[m,b]=y.useState(!1),[a,p]=y.useState(!1),[g,S]=y.useState(null),j=X(),T=B(),R=Number(d)||0,{data:t,isLoading:C}=q(R),k=t?.problemType==="MCQ"?"객관식":t?.problemType==="OX"?"OX":t?.problemType==="SHORT"?"단답형":"서술형",A=r==="group"?"그룹 문제":r==="personal"?"개인 문제":"복습 문제",I=n=>{h(n)},w=()=>{if(!t)return;let n="";if(t.problemType==="MCQ"){if(l===null)return;n=String(l)}else if(t.problemType==="OX"){if(l===null)return;n=l===0?"true":"false"}else{const o=c.trim();if(!o)return;n=o}const f=Number(t.problemId??0),N={answer:n};console.log("submit problemId",f,N),j.mutate({problemId:f,submitProblemBody:N},{onSuccess:o=>{S({isCorrect:o.isCorrect,explanation:o.explanation,aiFeedback:o.aiFeedback??null,currentGate:o.currentGate??null,reviewCount:o.reviewCount??null,nextReviewDate:o.nextReviewDate??null,isFirstAttempt:o.isFirstAttempt??!1,isReviewStateChanged:o.isReviewStateChanged??!1}),b(!0)}})},x=()=>{if(r==="personal")i("/personal-study");else if(r==="group"){const n=t?.studyRoomId;i(n?`/groups/${n}`:"/groups")}else i("/review")},O=()=>{if(r==="group"){if(u||t?.includeInReview){x();return}p(!0)}else x()},M=()=>{const n=Number(t?.problemId??0);n&&T.mutate({problemId:n,reviewInclusionBody:{includeInReview:!0}},{onSuccess:()=>{p(!1),x()}})},D=()=>{p(!1),x()},G=g?.isCorrect??!1;return C||!t?e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})})}):e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(L,{onBack:x,questionType:k,category:A,title:t?.question??""}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 relative",children:[!m&&(t?.problemType==="SHORT"||t?.problemType==="SUBJECTIVE")&&j.isPending&&e.jsxs("div",{className:"absolute inset-0 z-10 bg-white/70 backdrop-blur-[1px] flex flex-col items-center justify-center text-center p-6 rounded-lg",children:[e.jsx("i",{className:"ri-loader-4-line animate-spin text-3xl text-blue-600 mb-3"}),e.jsx("div",{className:"text-gray-900 font-medium mb-1",children:"채점 중입니다..."}),e.jsx("div",{className:"text-gray-600 text-sm",children:"AI 채점은 최대 1분이 걸릴 수 있어요."})]}),m?e.jsx(e.Fragment,{children:(()=>{let n="";if(t?.problemType==="OX"){const f=l===0?"O":"X";n=g?.isCorrect??!1?f:f==="O"?"X":"O"}return e.jsx(H,{isCorrect:G,correctAnswerText:n,explanation:g?.explanation??"",aiFeedback:g?.aiFeedback??null,currentGate:g?.currentGate??null,nextReviewDate:g?.nextReviewDate??null,onConfirm:O})})()}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{content:t?.question??""}),(t?.problemType==="MCQ"||t?.problemType==="OX")&&e.jsx($,{options:t?.problemType==="MCQ"?t?.choices??[]:["O","X"],selectedAnswer:l,onSelect:I,onCancel:x,onSubmit:w,isSubmitDisabled:l===null||j.isPending}),(t?.problemType==="SHORT"||t?.problemType==="SUBJECTIVE")&&e.jsx(U,{value:c,onChange:v,onCancel:x,onSubmit:w,isSubmitDisabled:c.trim().length===0||j.isPending})]})]}),e.jsx(P,{open:a,title:t?.question??"",onSkip:D,onAdd:M})]})};export{K as default};
